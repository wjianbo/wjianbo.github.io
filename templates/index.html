{% extends "base.html" %}
{% block content %}

<section class="daily-quote">
  <p class="daily-quote-label">今日の一句</p>
  <div class="daily-quote-card">
    <p class="daily-quote-text" id="quote-text">加载中…</p>
    <p class="daily-quote-meta" id="quote-meta"></p>
  </div>
</section>

<script>
fetch("https://wjianbo.github.io/aozorabunko/daily.json")
  .then(r => r.json())
  .then(data => {
    const q = data.quote;

    // 如果你有 normalizeAozoraText，这里可以接上
    document.getElementById("quote-text").innerHTML = q.text;
    document.getElementById("quote-meta").textContent =
      `${q.author}《${q.title}》`;
  })
  .catch(() => {
    document.getElementById("quote-text").textContent = "今日一句加载失败。";
  });
</script>

{# 1. 从 index.md 读取配置 #}
{% set section_path = section.extra.recent_section | default(value="posts") %}
{% set limit = section.extra.recent_limit | default(value=5) %}

{# 2. 获取目标 section #}
{% set recent = get_section(path=section_path ~ "/_index.md") %}

{# 3. 处理内容插槽 #}
{% set content = section.content | safe %}
{% set parts = content | split(pat="<!-- POSTS -->") %}

{% if parts | length > 1 %}

{{ parts[0] | safe }}

<ul class="post-list">
  {% for post in recent.pages | slice(start=0, end=limit) %}
  <li>
    <a href="{{ post.permalink }}">{{ post.title }}</a>
    <span class="post-date">{{ post.date }}</span>
  </li>
  {% endfor %}
</ul>

{% if section.extra.recent_section %}
<p class="section-link">
  <a href="/{{ section.extra.recent_section }}/">→</a>
</p>
{% endif %}


{{ parts[1] | safe }}

{% else %}

{{ content | safe }}

{% endif %}

{% endblock content %}